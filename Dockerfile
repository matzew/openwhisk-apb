FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG9wZW53aGlzay1zZXJ2aWNlLWFwYgpkZXNjcmlwdGlvbjogPgog\
IEFwYWNoZSBPcGVuV2hpc2sgaXMgYSBzZXJ2ZXJsZXNzLCBvcGVuIHNvdXJjZSBjbG91ZCBwbGF0\
Zm9ybSB0aGF0CiAgZXhlY3V0ZXMgZnVuY3Rpb25zIGluIHJlc3BvbnNlIHRvIGV2ZW50cyBhdCBh\
bnkgc2NhbGUuCmJpbmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdzOgogIC0gRmFhUwog\
IC0gT3BlbldoaXNrCiAgLSBtb2JpbGUtc2VydmljZQogIC0gbW9iaWxlLWNsaWVudC1lbmFibGVk\
Cm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBBcGFjaGUgT3BlbldoaXNrCiAgY29uc29sZS5vcGVu\
c2hpZnQuaW8vaWNvbkNsYXNzOiBpY29uLWFwYWNoZQogIGltYWdlVXJsOiBodHRwczovL2dpdGh1\
Yi5jb20vYXBhY2hlL2luY3ViYXRvci1vcGVud2hpc2svYmxvYi9tYXN0ZXIvZG9jcy9pbWFnZXMv\
d2hpc2tfaWNvbl9mdWxsLWNvbG9yX3dpdGhfdG1fMTI4eDEyOC0zMDBkcGkucG5nP3Jhdz10cnVl\
CiAgZG9jdW1lbnRhdGlvblVybDogaHR0cHM6Ly9vcGVud2hpc2suYXBhY2hlLm9yZy8KICBzZXJ2\
aWNlTmFtZTogYXBhY2hlLW9wZW53aGlzawogIGRlcGVuZGVuY2llczogW10KcGxhbnM6CiAgLSBu\
YW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogVGhpcyBkZWZhdWx0IHBsYW4gZGVwbG95cyBv\
cGVud2hpc2stc2VydmljZQogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJh\
bWV0ZXJzOiBbXQogICAgYmluZF9wYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IGFjdGlvbl9pZAog\
ICAgICAgIHRpdGxlOiBUaGUgbmFtZSBvZiB0aGUgT3BlbldoaXNrIGFjdGlvbl9pZAogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6ICcnCiAgICAgICAgcmVxdWlyZWQ6IFRydWUK\
ICAgICAgLSBuYW1lOiBhY3Rpb24KICAgICAgICB0aXRsZTogRGVmaW5lIHRoZSBhY3Rpb24gaW4g\
SmF2YVNjcmlwdCAoTm9kZS5qcyA2IFJ1bnRpbWUpCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgZGlzcGxheV90eXBlOiB0ZXh0YXJlYQogICAgICAgIGRlZmF1bHQ6ICcnCiAgICAgICAgcmVx\
dWlyZWQ6IFRydWUKICAgICAgLSBuYW1lOiBjbGllbnRfaWQKICAgICAgICB0aXRsZTogTW9iaWxl\
IENsaWVudCBJZGVudGlmaWVyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDog\
JycKICAgICAgICByZXF1aXJlZDogVHJ1ZQo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
